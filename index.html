<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qu·∫£n l√Ω ph√≠ ship</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f9f9f9;
    }
    h2 { text-align: center; margin-bottom: 15px; }
    .form { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
    input, button { padding: 12px; font-size: 16px; border: 1px solid #ccc; border-radius: 6px; }
    button { background: #007bff; color: white; border: none; cursor: pointer; }
    button:hover { background: #0056b3; }
    .table-container { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; background: white; border-radius: 6px; overflow: hidden; }
    th, td { padding: 12px; border: 1px solid #eee; font-size: 15px; white-space: nowrap; }
    th { background: #f2f2f2; }
    td button { background: #dc3545; border: none; color: white; padding: 8px 12px; border-radius: 4px; cursor: pointer; }
    td button:hover { background: #b02a37; }
    .total { font-size: 18px; font-weight: bold; margin-top: 15px; text-align: right; }
    .actions { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; }
    .clear-btn { background: #dc3545; padding: 10px 15px; font-size: 15px; border-radius: 6px; }
    .clear-btn:hover { background: #b02a37; }
    footer { margin-top: 30px; padding: 15px; text-align: center; font-size: 14px; color: #555; background: #f2f2f2; border-top: 1px solid #ddd; border-radius: 6px; line-height: 1.6; }
    @media (max-width: 600px) {
      th, td { font-size: 13px; padding: 8px; }
      input, button { font-size: 14px; padding: 10px; }
      .total { font-size: 16px; }
    }
  </style>
</head>
<body>
  <h2>Qu·∫£n l√Ω ph√≠ ship</h2>

  <!-- Form nh·∫≠p ƒë∆°n h√†ng -->
  <div class="form">
    <input type="date" id="date">
    <input type="text" id="order" placeholder="ƒê∆°n h√†ng">
    <input type="text" id="address" placeholder="ƒê·ªãa ch·ªâ">
    <input type="text" id="fee" placeholder="Ph√≠ ship (ƒë)" inputmode="numeric" pattern="[0-9]*">
    <button onclick="addOrder()">‚ûï Th√™m ƒë∆°n</button>
  </div>

  <!-- B·∫£ng hi·ªÉn th·ªã ƒë∆°n h√†ng -->
  <div class="table-container">
    <table id="orderTable">
      <thead>
        <tr>
          <th>Ng√†y</th>
          <th>ƒê∆°n h√†ng</th>
          <th>ƒê·ªãa ch·ªâ</th>
          <th>Ph√≠ ship</th>
          <th>X√≥a</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- T·ªïng ph√≠ + n√∫t x√≥a t·∫•t c·∫£ -->
  <div class="actions">
    <div class="total">T·ªïng ph√≠: <span id="total">0</span> ƒë</div>
    <button class="clear-btn" onclick="clearAll()">üóëÔ∏è X√≥a t·∫•t c·∫£</button>
  </div>

  <!-- Footer -->
  <footer>
    ¬© 2025 <strong>LATxBONA</strong> ‚Äî Thi·∫øt k·∫ø &amp; ph√°t tri·ªÉn b·ªüi LAT <br>
    ·ª®ng d·ª•ng: <em>Qu·∫£n l√Ω ph√≠ ship</em> ‚Äî T√≠nh t·ªïng ph√≠ theo ng√†y
  </footer>

  <!-- Firebase SDK -->
  <script type="module">
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

    // üî• Config Firebase (thay b·∫±ng config c·ªßa b·∫°n trong Firebase Console)
  const firebaseConfig = {
    apiKey: "AIzaSyCuUoOJIKom95p2pusyi6oLo-NQvMMOsbw",
    authDomain: "shipingfee-45cff.firebaseapp.com",
    projectId: "shipingfee-45cff",
    storageBucket: "shipingfee-45cff.firebasestorage.app",
    messagingSenderId: "518557431845",
    appId: "1:518557431845:web:0873293e1eafedbcf627cc",
    measurementId: "G-W558XRN5TF"
  };

    // Kh·ªüi t·∫°o Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ƒê·ªãnh d·∫°ng ng√†y
    function formatDate(dateStr) {
      let [y, m, d] = dateStr.split("-");
      return `${d}/${m}/${y}`;
    }

    // Load ƒë∆°n h√†ng
    async function loadOrders() {
      let tbody = document.querySelector("#orderTable tbody");
      tbody.innerHTML = "";
      let total = 0;

      const q = query(collection(db, "orders"));
      const snapshot = await getDocs(q);

      snapshot.forEach((docSnap) => {
        let o = docSnap.data();
        let tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${formatDate(o.date)}</td>
          <td>${o.order}</td>
          <td>${o.address}</td>
          <td>${Number(o.fee).toLocaleString("vi-VN")} ƒë</td>
          <td><button onclick="deleteOrder('${docSnap.id}')">X√≥a</button></td>
        `;
        tbody.appendChild(tr);
        total += Number(o.fee);
      });

      document.getElementById("total").textContent = total.toLocaleString("vi-VN");
    }

    // Th√™m ƒë∆°n h√†ng
    window.addOrder = async function() {
      let date = document.getElementById("date").value;
      let order = document.getElementById("order").value.trim();
      let address = document.getElementById("address").value.trim();
      let fee = document.getElementById("fee").value.replace(/\./g, "").replace(/,/g, "");

      if (date && order && address && fee) {
        await addDoc(collection(db, "orders"), { date, order, address, fee });
        document.getElementById("order").value = "";
        document.getElementById("address").value = "";
        document.getElementById("fee").value = "";
        loadOrders();
      } else {
        alert("Vui l√≤ng nh·∫≠p ƒë·ªß th√¥ng tin!");
      }
    };

    // X√≥a ƒë∆°n h√†ng
    window.deleteOrder = async function(id) {
      if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ƒë∆°n n√†y?")) {
        await deleteDoc(doc(db, "orders", id));
        loadOrders();
      }
    };

    // X√≥a t·∫•t c·∫£ ƒë∆°n h√†ng
    window.clearAll = async function() {
      if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a T·∫§T C·∫¢ ƒë∆°n h√†ng?")) {
        const q = query(collection(db, "orders"));
        const snapshot = await getDocs(q);
        for (const docSnap of snapshot.docs) {
          await deleteDoc(doc(db, "orders", docSnap.id));
        }
        loadOrders();
      }
    };

    // Format s·ªë ti·ªÅn khi nh·∫≠p
    const feeInput = document.getElementById("fee");
    feeInput.addEventListener("input", () => {
      let value = feeInput.value.replace(/\D/g, "");
      if (value) {
        feeInput.value = Number(value).toLocaleString("vi-VN");
      }
    });

    // Set ng√†y h√¥m nay + load
    window.onload = () => {
      let today = new Date().toISOString().split("T")[0];
      document.getElementById("date").value = today;
      loadOrders();
    };
  </script>
</body>
</html>
